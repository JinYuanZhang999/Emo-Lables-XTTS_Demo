<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Demo Page</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>

    <!-- 1. 顶部全宽背景区域 (Header Wrapper) -->
    <!-- 这个 div 负责显示渐变色背景 -->
    <div id="header-wrapper">
        <!-- 这个 div 负责限制内容宽度并居中 -->
        <div class="container header-content" id="header-app">
            <!-- JS 将在这里插入标题、作者等 -->
        </div>
    </div>

    <!-- 2. 主体白底区域 (Main Wrapper) -->
    <div class="container" id="main-app">
        <!-- JS 将在这里插入摘要、图片、表格 -->
        <p style="text-align: center; margin-top: 50px; color: #666;">Loading data...</p>
    </div>

    <script>
        async function loadData() {
            try {
                // 这里的路径需要和你的实际文件路径一致
                const response = await fetch('./data.json');
                const data = await response.json();
                renderPage(data);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('main-app').innerHTML = '<p style="color:red; text-align:center;">无法加载 data.json，请检查控制台错误或确认通过服务器运行。</p>';
            }
        }

        function renderPage(data) {
            const headerApp = document.getElementById('header-app');
            const mainApp = document.getElementById('main-app');
            
            // 清空默认内容
            headerApp.innerHTML = '';
            mainApp.innerHTML = '';

            // ===========================
            // 渲染 Header (标题部分)
            // ===========================
            
            // 1. 标题
            const title = document.createElement('h1');
            title.className = 'paper-title';
            title.textContent = data.meta.title;
            headerApp.appendChild(title);

            // 2. 作者
            const authors = document.createElement('div');
            authors.className = 'authors';
            authors.innerHTML = data.meta.authors.join(', ');
            headerApp.appendChild(authors);

            // 3. 机构
            if (data.meta.institution) {
                const inst = document.createElement('div');
                inst.className = 'institution';
                inst.textContent = data.meta.institution;
                headerApp.appendChild(inst);
            }

            // 4. 链接按钮
            if (data.meta.links && data.meta.links.length > 0) {
                const linkContainer = document.createElement('div');
                linkContainer.className = 'link-buttons';
                data.meta.links.forEach(link => {
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.className = 'btn-header';
                    a.textContent = link.name;
                    a.target = "_blank";
                    linkContainer.appendChild(a);
                });
                headerApp.appendChild(linkContainer);
            }


            // ===========================
            // 渲染 Main (内容部分)
            // ===========================


            // 5. 摘要 (Abstract)
            if (data.meta.abstract) {
                const abstract = document.createElement('div');
                abstract.className = 'abstract-box';
                abstract.innerHTML = `<h2 class="experiment-title">Abstract</h2><p>${data.meta.abstract}</p>`;
                mainApp.appendChild(abstract);
            }


            // 6. Model Architecture图片 (Teaser Image)
            if (data.meta.teaserImage) {
                // 外层白色卡片（和 experiment-section 类似）
                const modelSection = document.createElement('div');
                modelSection.className = 'model-section';

                // 标题：复用 experiment-title 的样式
                const title = document.createElement('h2');
                title.className = 'experiment-title';
                title.textContent = 'Model Architecture';

                // 横向滚动容器：确保图片不会被裁切/压扁
                const figure = document.createElement('div');
                figure.className = 'model-figure';

                const img = document.createElement('img');
                img.src = data.meta.teaserImage;
                img.alt = 'Model Architecture';
                img.className = 'model-img';

                figure.appendChild(img);
                modelSection.appendChild(title);
                modelSection.appendChild(figure);
                mainApp.appendChild(modelSection);
            }


            // 7. 实验表格
            if (data.experiments) {
                data.experiments.forEach(exp => {
                    const isEmotionControlAccuracy =
                    (exp.title || '').toLowerCase().includes('emotion control accuracy');

                    const section = document.createElement('div');
                    section.className = 'experiment-section';

                    const h2 = document.createElement('h2');
                    h2.className = 'experiment-title';
                    h2.textContent = exp.title;
                    section.appendChild(h2);

                    if (exp.description) {
                        const p = document.createElement('p');
                        p.className = 'experiment-desc';
                        p.textContent = exp.description;
                        section.appendChild(p);
                    }

                    const table = document.createElement('table');
                    table.className = 'audio-table';

                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    exp.columns.forEach(colName => {
                        const th = document.createElement('th');
                        th.textContent = colName;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    const tbody = document.createElement('tbody');
                    exp.rows.forEach(row => {
                        const tr = document.createElement('tr');

                        // ✅ 只有非 Emotion Control Accuracy 才渲染第一列 text
                        if (!isEmotionControlAccuracy) {
                            const tdText = document.createElement('td');
                            tdText.textContent = row.text || '';
                            tr.appendChild(tdText);
                        }

                        row.audios.forEach(audioSrc => {
                            const tdAudio = document.createElement('td');
                            if (audioSrc) {
                                const audio = document.createElement('audio');
                                audio.controls = true;
                                audio.preload = "metadata";
                                const source = document.createElement('source');
                                source.src = audioSrc;
                                if (audioSrc.endsWith('.wav')) source.type = 'audio/wav';
                                else if (audioSrc.endsWith('.mp3')) source.type = 'audio/mpeg';
                                audio.appendChild(source);
                                tdAudio.appendChild(audio);
                            } else {
                                tdAudio.textContent = "-";
                            }
                            tr.appendChild(tdAudio);
                        });
                        tbody.appendChild(tr);
                    });
                    table.appendChild(tbody);

                    const scroll = document.createElement('div');
                    scroll.className = 'table-scroll';
                    scroll.appendChild(table);

                    section.appendChild(scroll);
                    mainApp.appendChild(section);
                });

            }
        }

        loadData();
    </script>
</body>
</html>